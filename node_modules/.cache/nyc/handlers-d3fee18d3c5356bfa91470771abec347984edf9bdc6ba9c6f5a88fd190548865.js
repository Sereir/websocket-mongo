function cov_2k9ptrea0c(){var path="C:\\Users\\Nacim\\Documents\\websocket-mongo\\src\\socket\\handlers.js";var hash="fd53b13ac6cb4977155aa299dc78bebacefbea10";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\Nacim\\Documents\\websocket-mongo\\src\\socket\\handlers.js",statementMap:{"0":{start:{line:1,column:12},end:{line:1,column:35}},"1":{start:{line:2,column:16},end:{line:2,column:44}},"2":{start:{line:3,column:13},end:{line:3,column:38}},"3":{start:{line:6,column:12},end:{line:6,column:61}},"4":{start:{line:7,column:2},end:{line:7,column:18}},"5":{start:{line:7,column:9},end:{line:7,column:18}},"6":{start:{line:8,column:17},end:{line:8,column:56}},"7":{start:{line:9,column:26},end:{line:9,column:43}},"8":{start:{line:10,column:2},end:{line:10,column:49}},"9":{start:{line:10,column:36},end:{line:10,column:49}},"10":{start:{line:11,column:2},end:{line:11,column:14}},"11":{start:{line:16,column:13},end:{line:16,column:19}},"12":{start:{line:17,column:14},end:{line:30,column:4}},"13":{start:{line:31,column:2},end:{line:31,column:39}},"14":{start:{line:31,column:24},end:{line:31,column:37}},"15":{start:{line:35,column:24},end:{line:35,column:33}},"16":{start:{line:37,column:2},end:{line:49,column:5}},"17":{start:{line:38,column:4},end:{line:48,column:5}},"18":{start:{line:39,column:20},end:{line:39,column:59}},"19":{start:{line:40,column:6},end:{line:40,column:58}},"20":{start:{line:40,column:18},end:{line:40,column:58}},"21":{start:{line:41,column:22},end:{line:41,column:63}},"22":{start:{line:42,column:19},end:{line:42,column:65}},"23":{start:{line:43,column:6},end:{line:43,column:56}},"24":{start:{line:43,column:17},end:{line:43,column:56}},"25":{start:{line:44,column:6},end:{line:44,column:25}},"26":{start:{line:45,column:6},end:{line:45,column:20}},"27":{start:{line:47,column:6},end:{line:47,column:45}},"28":{start:{line:51,column:2},end:{line:180,column:5}},"29":{start:{line:52,column:17},end:{line:52,column:28}},"30":{start:{line:54,column:4},end:{line:54,column:93}},"31":{start:{line:54,column:46},end:{line:54,column:93}},"32":{start:{line:55,column:4},end:{line:55,column:55}},"33":{start:{line:58,column:4},end:{line:61,column:18}},"34":{start:{line:59,column:6},end:{line:59,column:29}},"35":{start:{line:60,column:6},end:{line:60,column:24}},"36":{start:{line:63,column:4},end:{line:73,column:18}},"37":{start:{line:64,column:23},end:{line:64,column:50}},"38":{start:{line:65,column:6},end:{line:72,column:7}},"39":{start:{line:66,column:27},end:{line:66,column:57}},"40":{start:{line:67,column:8},end:{line:71,column:9}},"41":{start:{line:68,column:10},end:{line:70,column:11}},"42":{start:{line:69,column:12},end:{line:69,column:91}},"43":{start:{line:75,column:4},end:{line:105,column:7}},"44":{start:{line:76,column:6},end:{line:104,column:7}},"45":{start:{line:77,column:32},end:{line:77,column:45}},"46":{start:{line:78,column:8},end:{line:80,column:9}},"47":{start:{line:79,column:10},end:{line:79,column:120}},"48":{start:{line:81,column:26},end:{line:81,column:63}},"49":{start:{line:82,column:8},end:{line:82,column:123}},"50":{start:{line:82,column:24},end:{line:82,column:123}},"51":{start:{line:84,column:20},end:{line:84,column:113}},"52":{start:{line:87,column:27},end:{line:87,column:67}},"53":{start:{line:88,column:8},end:{line:99,column:9}},"54":{start:{line:89,column:10},end:{line:98,column:11}},"55":{start:{line:90,column:12},end:{line:97,column:15}},"56":{start:{line:101,column:8},end:{line:101,column:54}},"57":{start:{line:103,column:8},end:{line:103,column:83}},"58":{start:{line:107,column:4},end:{line:125,column:7}},"59":{start:{line:108,column:6},end:{line:124,column:20}},"60":{start:{line:109,column:30},end:{line:109,column:43}},"61":{start:{line:110,column:20},end:{line:110,column:53}},"62":{start:{line:111,column:8},end:{line:111,column:25}},"63":{start:{line:111,column:18},end:{line:111,column:25}},"64":{start:{line:112,column:8},end:{line:112,column:63}},"65":{start:{line:112,column:56},end:{line:112,column:63}},"66":{start:{line:113,column:8},end:{line:116,column:9}},"67":{start:{line:114,column:10},end:{line:114,column:30}},"68":{start:{line:115,column:10},end:{line:115,column:27}},"69":{start:{line:118,column:27},end:{line:118,column:64}},"70":{start:{line:119,column:8},end:{line:123,column:9}},"71":{start:{line:120,column:10},end:{line:122,column:11}},"72":{start:{line:121,column:12},end:{line:121,column:94}},"73":{start:{line:128,column:4},end:{line:145,column:7}},"74":{start:{line:129,column:29},end:{line:129,column:42}},"75":{start:{line:130,column:6},end:{line:130,column:22}},"76":{start:{line:130,column:15},end:{line:130,column:22}},"77":{start:{line:131,column:25},end:{line:131,column:54}},"78":{start:{line:132,column:6},end:{line:136,column:7}},"79":{start:{line:133,column:8},end:{line:135,column:9}},"80":{start:{line:134,column:10},end:{line:134,column:100}},"81":{start:{line:137,column:6},end:{line:144,column:7}},"82":{start:{line:138,column:8},end:{line:143,column:17}},"83":{start:{line:139,column:30},end:{line:139,column:59}},"84":{start:{line:140,column:10},end:{line:142,column:11}},"85":{start:{line:141,column:12},end:{line:141,column:130}},"86":{start:{line:141,column:43},end:{line:141,column:130}},"87":{start:{line:148,column:4},end:{line:155,column:7}},"88":{start:{line:149,column:6},end:{line:154,column:7}},"89":{start:{line:150,column:22},end:{line:150,column:77}},"90":{start:{line:151,column:8},end:{line:151,column:145}},"91":{start:{line:151,column:54},end:{line:151,column:139}},"92":{start:{line:153,column:8},end:{line:153,column:32}},"93":{start:{line:157,column:4},end:{line:179,column:7}},"94":{start:{line:158,column:25},end:{line:158,column:60}},"95":{start:{line:159,column:6},end:{line:162,column:7}},"96":{start:{line:160,column:8},end:{line:160,column:37}},"97":{start:{line:161,column:8},end:{line:161,column:74}},"98":{start:{line:161,column:35},end:{line:161,column:74}},"99":{start:{line:163,column:6},end:{line:167,column:20}},"100":{start:{line:164,column:8},end:{line:164,column:32}},"101":{start:{line:165,column:8},end:{line:165,column:36}},"102":{start:{line:166,column:8},end:{line:166,column:26}},"103":{start:{line:168,column:6},end:{line:178,column:20}},"104":{start:{line:169,column:25},end:{line:169,column:52}},"105":{start:{line:170,column:8},end:{line:177,column:9}},"106":{start:{line:171,column:29},end:{line:171,column:59}},"107":{start:{line:172,column:10},end:{line:176,column:11}},"108":{start:{line:173,column:12},end:{line:175,column:13}},"109":{start:{line:174,column:14},end:{line:174,column:121}},"110":{start:{line:183,column:0},end:{line:183,column:32}}},fnMap:{"0":{name:"getTokenFromHandshake",decl:{start:{line:5,column:9},end:{line:5,column:30}},loc:{start:{line:5,column:42},end:{line:12,column:1}},line:5},"1":{name:"getContacts",decl:{start:{line:14,column:15},end:{line:14,column:26}},loc:{start:{line:14,column:35},end:{line:32,column:1}},line:14},"2":{name:"(anonymous_2)",decl:{start:{line:31,column:17},end:{line:31,column:18}},loc:{start:{line:31,column:24},end:{line:31,column:37}},line:31},"3":{name:"initSocket",decl:{start:{line:34,column:9},end:{line:34,column:19}},loc:{start:{line:34,column:24},end:{line:181,column:1}},line:34},"4":{name:"(anonymous_4)",decl:{start:{line:37,column:9},end:{line:37,column:10}},loc:{start:{line:37,column:33},end:{line:49,column:3}},line:37},"5":{name:"(anonymous_5)",decl:{start:{line:51,column:22},end:{line:51,column:23}},loc:{start:{line:51,column:40},end:{line:180,column:3}},line:51},"6":{name:"(anonymous_6)",decl:{start:{line:75,column:30},end:{line:75,column:31}},loc:{start:{line:75,column:54},end:{line:105,column:5}},line:75},"7":{name:"(anonymous_7)",decl:{start:{line:107,column:30},end:{line:107,column:31}},loc:{start:{line:107,column:49},end:{line:125,column:5}},line:107},"8":{name:"(anonymous_8)",decl:{start:{line:128,column:24},end:{line:128,column:25}},loc:{start:{line:128,column:43},end:{line:145,column:5}},line:128},"9":{name:"(anonymous_9)",decl:{start:{line:138,column:19},end:{line:138,column:20}},loc:{start:{line:138,column:25},end:{line:143,column:9}},line:138},"10":{name:"(anonymous_10)",decl:{start:{line:148,column:29},end:{line:148,column:30}},loc:{start:{line:148,column:43},end:{line:155,column:5}},line:148},"11":{name:"(anonymous_11)",decl:{start:{line:151,column:46},end:{line:151,column:47}},loc:{start:{line:151,column:54},end:{line:151,column:139}},line:151},"12":{name:"(anonymous_12)",decl:{start:{line:157,column:28},end:{line:157,column:29}},loc:{start:{line:157,column:40},end:{line:179,column:5}},line:157}},branchMap:{"0":{loc:{start:{line:6,column:12},end:{line:6,column:61}},type:"binary-expr",locations:[{start:{line:6,column:12},end:{line:6,column:34}},{start:{line:6,column:38},end:{line:6,column:61}}],line:6},"1":{loc:{start:{line:7,column:2},end:{line:7,column:18}},type:"if",locations:[{start:{line:7,column:2},end:{line:7,column:18}},{start:{line:7,column:2},end:{line:7,column:18}}],line:7},"2":{loc:{start:{line:8,column:17},end:{line:8,column:56}},type:"binary-expr",locations:[{start:{line:8,column:17},end:{line:8,column:50}},{start:{line:8,column:54},end:{line:8,column:56}}],line:8},"3":{loc:{start:{line:10,column:2},end:{line:10,column:49}},type:"if",locations:[{start:{line:10,column:2},end:{line:10,column:49}},{start:{line:10,column:2},end:{line:10,column:49}}],line:10},"4":{loc:{start:{line:10,column:6},end:{line:10,column:34}},type:"binary-expr",locations:[{start:{line:10,column:6},end:{line:10,column:25}},{start:{line:10,column:29},end:{line:10,column:34}}],line:10},"5":{loc:{start:{line:40,column:6},end:{line:40,column:58}},type:"if",locations:[{start:{line:40,column:6},end:{line:40,column:58}},{start:{line:40,column:6},end:{line:40,column:58}}],line:40},"6":{loc:{start:{line:42,column:39},end:{line:42,column:64}},type:"binary-expr",locations:[{start:{line:42,column:39},end:{line:42,column:50}},{start:{line:42,column:54},end:{line:42,column:64}}],line:42},"7":{loc:{start:{line:43,column:6},end:{line:43,column:56}},type:"if",locations:[{start:{line:43,column:6},end:{line:43,column:56}},{start:{line:43,column:6},end:{line:43,column:56}}],line:43},"8":{loc:{start:{line:54,column:4},end:{line:54,column:93}},type:"if",locations:[{start:{line:54,column:4},end:{line:54,column:93}},{start:{line:54,column:4},end:{line:54,column:93}}],line:54},"9":{loc:{start:{line:67,column:8},end:{line:71,column:9}},type:"if",locations:[{start:{line:67,column:8},end:{line:71,column:9}},{start:{line:67,column:8},end:{line:71,column:9}}],line:67},"10":{loc:{start:{line:77,column:32},end:{line:77,column:45}},type:"binary-expr",locations:[{start:{line:77,column:32},end:{line:77,column:39}},{start:{line:77,column:43},end:{line:77,column:45}}],line:77},"11":{loc:{start:{line:78,column:8},end:{line:80,column:9}},type:"if",locations:[{start:{line:78,column:8},end:{line:80,column:9}},{start:{line:78,column:8},end:{line:80,column:9}}],line:78},"12":{loc:{start:{line:78,column:12},end:{line:78,column:102}},type:"binary-expr",locations:[{start:{line:78,column:12},end:{line:78,column:15}},{start:{line:78,column:19},end:{line:78,column:46}},{start:{line:78,column:50},end:{line:78,column:77}},{start:{line:78,column:81},end:{line:78,column:102}}],line:78},"13":{loc:{start:{line:79,column:17},end:{line:79,column:119}},type:"binary-expr",locations:[{start:{line:79,column:17},end:{line:79,column:20}},{start:{line:79,column:24},end:{line:79,column:119}}],line:79},"14":{loc:{start:{line:82,column:8},end:{line:82,column:123}},type:"if",locations:[{start:{line:82,column:8},end:{line:82,column:123}},{start:{line:82,column:8},end:{line:82,column:123}}],line:82},"15":{loc:{start:{line:82,column:31},end:{line:82,column:122}},type:"binary-expr",locations:[{start:{line:82,column:31},end:{line:82,column:34}},{start:{line:82,column:38},end:{line:82,column:122}}],line:82},"16":{loc:{start:{line:88,column:8},end:{line:99,column:9}},type:"if",locations:[{start:{line:88,column:8},end:{line:99,column:9}},{start:{line:88,column:8},end:{line:99,column:9}}],line:88},"17":{loc:{start:{line:101,column:8},end:{line:101,column:53}},type:"binary-expr",locations:[{start:{line:101,column:8},end:{line:101,column:11}},{start:{line:101,column:15},end:{line:101,column:53}}],line:101},"18":{loc:{start:{line:103,column:8},end:{line:103,column:82}},type:"binary-expr",locations:[{start:{line:103,column:8},end:{line:103,column:11}},{start:{line:103,column:15},end:{line:103,column:82}}],line:103},"19":{loc:{start:{line:109,column:30},end:{line:109,column:43}},type:"binary-expr",locations:[{start:{line:109,column:30},end:{line:109,column:37}},{start:{line:109,column:41},end:{line:109,column:43}}],line:109},"20":{loc:{start:{line:111,column:8},end:{line:111,column:25}},type:"if",locations:[{start:{line:111,column:8},end:{line:111,column:25}},{start:{line:111,column:8},end:{line:111,column:25}}],line:111},"21":{loc:{start:{line:112,column:8},end:{line:112,column:63}},type:"if",locations:[{start:{line:112,column:8},end:{line:112,column:63}},{start:{line:112,column:8},end:{line:112,column:63}}],line:112},"22":{loc:{start:{line:113,column:8},end:{line:116,column:9}},type:"if",locations:[{start:{line:113,column:8},end:{line:116,column:9}},{start:{line:113,column:8},end:{line:116,column:9}}],line:113},"23":{loc:{start:{line:119,column:8},end:{line:123,column:9}},type:"if",locations:[{start:{line:119,column:8},end:{line:123,column:9}},{start:{line:119,column:8},end:{line:123,column:9}}],line:119},"24":{loc:{start:{line:129,column:29},end:{line:129,column:42}},type:"binary-expr",locations:[{start:{line:129,column:29},end:{line:129,column:36}},{start:{line:129,column:40},end:{line:129,column:42}}],line:129},"25":{loc:{start:{line:130,column:6},end:{line:130,column:22}},type:"if",locations:[{start:{line:130,column:6},end:{line:130,column:22}},{start:{line:130,column:6},end:{line:130,column:22}}],line:130},"26":{loc:{start:{line:132,column:6},end:{line:136,column:7}},type:"if",locations:[{start:{line:132,column:6},end:{line:136,column:7}},{start:{line:132,column:6},end:{line:136,column:7}}],line:132},"27":{loc:{start:{line:137,column:6},end:{line:144,column:7}},type:"if",locations:[{start:{line:137,column:6},end:{line:144,column:7}},{start:{line:137,column:6},end:{line:144,column:7}}],line:137},"28":{loc:{start:{line:140,column:10},end:{line:142,column:11}},type:"if",locations:[{start:{line:140,column:10},end:{line:142,column:11}},{start:{line:140,column:10},end:{line:142,column:11}}],line:140},"29":{loc:{start:{line:151,column:8},end:{line:151,column:144}},type:"binary-expr",locations:[{start:{line:151,column:8},end:{line:151,column:10}},{start:{line:151,column:14},end:{line:151,column:144}}],line:151},"30":{loc:{start:{line:153,column:8},end:{line:153,column:31}},type:"binary-expr",locations:[{start:{line:153,column:8},end:{line:153,column:10}},{start:{line:153,column:14},end:{line:153,column:31}}],line:153},"31":{loc:{start:{line:159,column:6},end:{line:162,column:7}},type:"if",locations:[{start:{line:159,column:6},end:{line:162,column:7}},{start:{line:159,column:6},end:{line:162,column:7}}],line:159},"32":{loc:{start:{line:161,column:8},end:{line:161,column:74}},type:"if",locations:[{start:{line:161,column:8},end:{line:161,column:74}},{start:{line:161,column:8},end:{line:161,column:74}}],line:161},"33":{loc:{start:{line:172,column:10},end:{line:176,column:11}},type:"if",locations:[{start:{line:172,column:10},end:{line:176,column:11}},{start:{line:172,column:10},end:{line:176,column:11}}],line:172}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0,0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"fd53b13ac6cb4977155aa299dc78bebacefbea10"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_2k9ptrea0c=function(){return actualCoverage;};}return actualCoverage;}cov_2k9ptrea0c();const jwt=(cov_2k9ptrea0c().s[0]++,require('jsonwebtoken'));const Message=(cov_2k9ptrea0c().s[1]++,require('../models/Message'));const User=(cov_2k9ptrea0c().s[2]++,require('../models/User'));function getTokenFromHandshake(handshake){cov_2k9ptrea0c().f[0]++;const t=(cov_2k9ptrea0c().s[3]++,(cov_2k9ptrea0c().b[0][0]++,handshake?.auth?.token)||(cov_2k9ptrea0c().b[0][1]++,handshake?.query?.token));cov_2k9ptrea0c().s[4]++;if(t){cov_2k9ptrea0c().b[1][0]++;cov_2k9ptrea0c().s[5]++;return t;}else{cov_2k9ptrea0c().b[1][1]++;}const header=(cov_2k9ptrea0c().s[6]++,(cov_2k9ptrea0c().b[2][0]++,handshake?.headers?.authorization)||(cov_2k9ptrea0c().b[2][1]++,''));const[scheme,token]=(cov_2k9ptrea0c().s[7]++,header.split(' '));cov_2k9ptrea0c().s[8]++;if((cov_2k9ptrea0c().b[4][0]++,scheme==='Bearer')&&(cov_2k9ptrea0c().b[4][1]++,token)){cov_2k9ptrea0c().b[3][0]++;cov_2k9ptrea0c().s[9]++;return token;}else{cov_2k9ptrea0c().b[3][1]++;}cov_2k9ptrea0c().s[10]++;return null;}async function getContacts(userId){cov_2k9ptrea0c().f[1]++;// Renvoie la liste des userIds ayant déjà une conversation 1-to-1 avec userId
const me=(cov_2k9ptrea0c().s[11]++,userId);const out=(cov_2k9ptrea0c().s[12]++,await Message.aggregate([{$match:{deleted:false,$or:[{sender:me},{recipient:me}]}},{$project:{other:{$cond:[{$eq:['$sender',me]},'$recipient','$sender']}}},{$group:{_id:'$other'}}]));cov_2k9ptrea0c().s[13]++;return out.map(d=>{cov_2k9ptrea0c().f[2]++;cov_2k9ptrea0c().s[14]++;return String(d._id);});}function initSocket(io){cov_2k9ptrea0c().f[3]++;const socketsByUser=(cov_2k9ptrea0c().s[15]++,new Map());// userId -> Set(socketIds)
cov_2k9ptrea0c().s[16]++;io.use(async(socket,next)=>{cov_2k9ptrea0c().f[4]++;cov_2k9ptrea0c().s[17]++;try{const token=(cov_2k9ptrea0c().s[18]++,getTokenFromHandshake(socket.handshake));cov_2k9ptrea0c().s[19]++;if(!token){cov_2k9ptrea0c().b[5][0]++;cov_2k9ptrea0c().s[20]++;return next(new Error('auth_required'));}else{cov_2k9ptrea0c().b[5][1]++;}const payload=(cov_2k9ptrea0c().s[21]++,jwt.verify(token,process.env.JWT_SECRET));const user=(cov_2k9ptrea0c().s[22]++,await User.findById((cov_2k9ptrea0c().b[6][0]++,payload.sub)||(cov_2k9ptrea0c().b[6][1]++,payload.id)));cov_2k9ptrea0c().s[23]++;if(!user){cov_2k9ptrea0c().b[7][0]++;cov_2k9ptrea0c().s[24]++;return next(new Error('auth_invalid'));}else{cov_2k9ptrea0c().b[7][1]++;}cov_2k9ptrea0c().s[25]++;socket.user=user;// attache l’utilisateur
cov_2k9ptrea0c().s[26]++;return next();}catch(e){cov_2k9ptrea0c().s[27]++;return next(new Error('auth_invalid'));}});cov_2k9ptrea0c().s[28]++;io.on('connection',async socket=>{cov_2k9ptrea0c().f[5]++;const user=(cov_2k9ptrea0c().s[29]++,socket.user);// Map user -> socket
cov_2k9ptrea0c().s[30]++;if(!socketsByUser.has(String(user._id))){cov_2k9ptrea0c().b[8][0]++;cov_2k9ptrea0c().s[31]++;socketsByUser.set(String(user._id),new Set());}else{cov_2k9ptrea0c().b[8][1]++;}cov_2k9ptrea0c().s[32]++;socketsByUser.get(String(user._id)).add(socket.id);// Status online + notifier uniquement les contacts
cov_2k9ptrea0c().s[33]++;try{cov_2k9ptrea0c().s[34]++;user.status='online';cov_2k9ptrea0c().s[35]++;await user.save();}catch(_){}cov_2k9ptrea0c().s[36]++;try{const contacts=(cov_2k9ptrea0c().s[37]++,await getContacts(user._id));cov_2k9ptrea0c().s[38]++;for(const cid of contacts){const recSockets=(cov_2k9ptrea0c().s[39]++,socketsByUser.get(String(cid)));cov_2k9ptrea0c().s[40]++;if(recSockets){cov_2k9ptrea0c().b[9][0]++;cov_2k9ptrea0c().s[41]++;for(const sid of recSockets){cov_2k9ptrea0c().s[42]++;io.sockets.sockets.get(sid)?.emit('user-online',{userId:String(user._id)});}}else{cov_2k9ptrea0c().b[9][1]++;}}}catch(_){}cov_2k9ptrea0c().s[43]++;socket.on('send-message',async(payload,ack)=>{cov_2k9ptrea0c().f[6]++;cov_2k9ptrea0c().s[44]++;try{const{to,content}=(cov_2k9ptrea0c().s[45]++,(cov_2k9ptrea0c().b[10][0]++,payload)||(cov_2k9ptrea0c().b[10][1]++,{}));cov_2k9ptrea0c().s[46]++;if((cov_2k9ptrea0c().b[12][0]++,!to)||(cov_2k9ptrea0c().b[12][1]++,typeof content!=='string')||(cov_2k9ptrea0c().b[12][2]++,content.trim().length===0)||(cov_2k9ptrea0c().b[12][3]++,content.length>5000)){cov_2k9ptrea0c().b[11][0]++;cov_2k9ptrea0c().s[47]++;return(cov_2k9ptrea0c().b[13][0]++,ack)&&(cov_2k9ptrea0c().b[13][1]++,ack({ok:false,code:'INVALID_PAYLOAD',message:'Destinataire et contenu requis (<=5000)'}));}else{cov_2k9ptrea0c().b[11][1]++;}const recipient=(cov_2k9ptrea0c().s[48]++,await User.findById(to).select('_id'));cov_2k9ptrea0c().s[49]++;if(!recipient){cov_2k9ptrea0c().b[14][0]++;cov_2k9ptrea0c().s[50]++;return(cov_2k9ptrea0c().b[15][0]++,ack)&&(cov_2k9ptrea0c().b[15][1]++,ack({ok:false,code:'RECIPIENT_NOT_FOUND',message:'Destinataire introuvable'}));}else{cov_2k9ptrea0c().b[14][1]++;}const msg=(cov_2k9ptrea0c().s[51]++,await Message.create({sender:user._id,recipient:recipient._id,content:content.trim()}));// émettre au destinataire
const recSockets=(cov_2k9ptrea0c().s[52]++,socketsByUser.get(String(recipient._id)));cov_2k9ptrea0c().s[53]++;if(recSockets){cov_2k9ptrea0c().b[16][0]++;cov_2k9ptrea0c().s[54]++;for(const sid of recSockets){cov_2k9ptrea0c().s[55]++;io.sockets.sockets.get(sid)?.emit('message',{_id:String(msg._id),sender:String(msg.sender),recipient:String(msg.recipient),content:msg.content,status:msg.status,createdAt:msg.createdAt});}}else{cov_2k9ptrea0c().b[16][1]++;}cov_2k9ptrea0c().s[56]++;(cov_2k9ptrea0c().b[17][0]++,ack)&&(cov_2k9ptrea0c().b[17][1]++,ack({ok:true,id:String(msg._id)}));}catch(e){cov_2k9ptrea0c().s[57]++;(cov_2k9ptrea0c().b[18][0]++,ack)&&(cov_2k9ptrea0c().b[18][1]++,ack({ok:false,code:'SERVER_ERROR',message:'Erreur serveur'}));}});cov_2k9ptrea0c().s[58]++;socket.on('message-read',async payload=>{cov_2k9ptrea0c().f[7]++;cov_2k9ptrea0c().s[59]++;try{const{messageId}=(cov_2k9ptrea0c().s[60]++,(cov_2k9ptrea0c().b[19][0]++,payload)||(cov_2k9ptrea0c().b[19][1]++,{}));const msg=(cov_2k9ptrea0c().s[61]++,await Message.findById(messageId));cov_2k9ptrea0c().s[62]++;if(!msg){cov_2k9ptrea0c().b[20][0]++;cov_2k9ptrea0c().s[63]++;return;}else{cov_2k9ptrea0c().b[20][1]++;}cov_2k9ptrea0c().s[64]++;if(String(msg.recipient)!==String(user._id)){cov_2k9ptrea0c().b[21][0]++;cov_2k9ptrea0c().s[65]++;return;}else{cov_2k9ptrea0c().b[21][1]++;}// seul le destinataire
cov_2k9ptrea0c().s[66]++;if(msg.status!=='read'){cov_2k9ptrea0c().b[22][0]++;cov_2k9ptrea0c().s[67]++;msg.status='read';cov_2k9ptrea0c().s[68]++;await msg.save();}else{cov_2k9ptrea0c().b[22][1]++;}// notifier l’expéditeur
const expSockets=(cov_2k9ptrea0c().s[69]++,socketsByUser.get(String(msg.sender)));cov_2k9ptrea0c().s[70]++;if(expSockets){cov_2k9ptrea0c().b[23][0]++;cov_2k9ptrea0c().s[71]++;for(const sid of expSockets){cov_2k9ptrea0c().s[72]++;io.sockets.sockets.get(sid)?.emit('message-read',{messageId:String(msg._id)});}}else{cov_2k9ptrea0c().b[23][1]++;}}catch(_){}});// typing: { to, typing: boolean }
cov_2k9ptrea0c().s[73]++;socket.on('typing',async payload=>{cov_2k9ptrea0c().f[8]++;const{to,typing}=(cov_2k9ptrea0c().s[74]++,(cov_2k9ptrea0c().b[24][0]++,payload)||(cov_2k9ptrea0c().b[24][1]++,{}));cov_2k9ptrea0c().s[75]++;if(!to){cov_2k9ptrea0c().b[25][0]++;cov_2k9ptrea0c().s[76]++;return;}else{cov_2k9ptrea0c().b[25][1]++;}const recSockets=(cov_2k9ptrea0c().s[77]++,socketsByUser.get(String(to)));cov_2k9ptrea0c().s[78]++;if(recSockets){cov_2k9ptrea0c().b[26][0]++;cov_2k9ptrea0c().s[79]++;for(const sid of recSockets){cov_2k9ptrea0c().s[80]++;io.sockets.sockets.get(sid)?.emit('typing',{from:String(user._id),typing:!!typing});}}else{cov_2k9ptrea0c().b[26][1]++;}cov_2k9ptrea0c().s[81]++;if(typing){cov_2k9ptrea0c().b[27][0]++;cov_2k9ptrea0c().s[82]++;setTimeout(()=>{cov_2k9ptrea0c().f[9]++;const recSockets2=(cov_2k9ptrea0c().s[83]++,socketsByUser.get(String(to)));cov_2k9ptrea0c().s[84]++;if(recSockets2){cov_2k9ptrea0c().b[28][0]++;cov_2k9ptrea0c().s[85]++;for(const sid of recSockets2){cov_2k9ptrea0c().s[86]++;io.sockets.sockets.get(sid)?.emit('typing',{from:String(user._id),typing:false});}}else{cov_2k9ptrea0c().b[28][1]++;}},3000);}else{cov_2k9ptrea0c().b[27][1]++;}});// user-status: renvoie le statut courant de base
cov_2k9ptrea0c().s[87]++;socket.on('user-status',async cb=>{cov_2k9ptrea0c().f[10]++;cov_2k9ptrea0c().s[88]++;try{const users=(cov_2k9ptrea0c().s[89]++,await User.find({}).select('username status lastLogin'));cov_2k9ptrea0c().s[90]++;(cov_2k9ptrea0c().b[29][0]++,cb)&&(cov_2k9ptrea0c().b[29][1]++,cb({ok:true,users:users.map(u=>{cov_2k9ptrea0c().f[11]++;cov_2k9ptrea0c().s[91]++;return{id:String(u._id),username:u.username,status:u.status,lastLogin:u.lastLogin};})}));}catch(e){cov_2k9ptrea0c().s[92]++;(cov_2k9ptrea0c().b[30][0]++,cb)&&(cov_2k9ptrea0c().b[30][1]++,cb({ok:false}));}});cov_2k9ptrea0c().s[93]++;socket.on('disconnect',async()=>{cov_2k9ptrea0c().f[12]++;const setSockets=(cov_2k9ptrea0c().s[94]++,socketsByUser.get(String(user._id)));cov_2k9ptrea0c().s[95]++;if(setSockets){cov_2k9ptrea0c().b[31][0]++;cov_2k9ptrea0c().s[96]++;setSockets.delete(socket.id);cov_2k9ptrea0c().s[97]++;if(setSockets.size===0){cov_2k9ptrea0c().b[32][0]++;cov_2k9ptrea0c().s[98]++;socketsByUser.delete(String(user._id));}else{cov_2k9ptrea0c().b[32][1]++;}}else{cov_2k9ptrea0c().b[31][1]++;}cov_2k9ptrea0c().s[99]++;try{cov_2k9ptrea0c().s[100]++;user.status='offline';cov_2k9ptrea0c().s[101]++;user.lastLogin=new Date();cov_2k9ptrea0c().s[102]++;await user.save();}catch(_){}cov_2k9ptrea0c().s[103]++;try{const contacts=(cov_2k9ptrea0c().s[104]++,await getContacts(user._id));cov_2k9ptrea0c().s[105]++;for(const cid of contacts){const recSockets=(cov_2k9ptrea0c().s[106]++,socketsByUser.get(String(cid)));cov_2k9ptrea0c().s[107]++;if(recSockets){cov_2k9ptrea0c().b[33][0]++;cov_2k9ptrea0c().s[108]++;for(const sid of recSockets){cov_2k9ptrea0c().s[109]++;io.sockets.sockets.get(sid)?.emit('user-offline',{userId:String(user._id),lastLogin:user.lastLogin});}}else{cov_2k9ptrea0c().b[33][1]++;}}}catch(_){}});});}cov_2k9ptrea0c().s[110]++;module.exports={initSocket};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMms5cHRyZWEwYyIsImFjdHVhbENvdmVyYWdlIiwiand0IiwicyIsInJlcXVpcmUiLCJNZXNzYWdlIiwiVXNlciIsImdldFRva2VuRnJvbUhhbmRzaGFrZSIsImhhbmRzaGFrZSIsImYiLCJ0IiwiYiIsImF1dGgiLCJ0b2tlbiIsInF1ZXJ5IiwiaGVhZGVyIiwiaGVhZGVycyIsImF1dGhvcml6YXRpb24iLCJzY2hlbWUiLCJzcGxpdCIsImdldENvbnRhY3RzIiwidXNlcklkIiwibWUiLCJvdXQiLCJhZ2dyZWdhdGUiLCIkbWF0Y2giLCJkZWxldGVkIiwiJG9yIiwic2VuZGVyIiwicmVjaXBpZW50IiwiJHByb2plY3QiLCJvdGhlciIsIiRjb25kIiwiJGVxIiwiJGdyb3VwIiwiX2lkIiwibWFwIiwiZCIsIlN0cmluZyIsImluaXRTb2NrZXQiLCJpbyIsInNvY2tldHNCeVVzZXIiLCJNYXAiLCJ1c2UiLCJzb2NrZXQiLCJuZXh0IiwiRXJyb3IiLCJwYXlsb2FkIiwidmVyaWZ5IiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJ1c2VyIiwiZmluZEJ5SWQiLCJzdWIiLCJpZCIsImUiLCJvbiIsImhhcyIsInNldCIsIlNldCIsImdldCIsImFkZCIsInN0YXR1cyIsInNhdmUiLCJfIiwiY29udGFjdHMiLCJjaWQiLCJyZWNTb2NrZXRzIiwic2lkIiwic29ja2V0cyIsImVtaXQiLCJhY2siLCJ0byIsImNvbnRlbnQiLCJ0cmltIiwibGVuZ3RoIiwib2siLCJjb2RlIiwibWVzc2FnZSIsInNlbGVjdCIsIm1zZyIsImNyZWF0ZSIsImNyZWF0ZWRBdCIsIm1lc3NhZ2VJZCIsImV4cFNvY2tldHMiLCJ0eXBpbmciLCJmcm9tIiwic2V0VGltZW91dCIsInJlY1NvY2tldHMyIiwiY2IiLCJ1c2VycyIsImZpbmQiLCJ1IiwidXNlcm5hbWUiLCJsYXN0TG9naW4iLCJzZXRTb2NrZXRzIiwiZGVsZXRlIiwic2l6ZSIsIkRhdGUiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiaGFuZGxlcnMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgand0ID0gcmVxdWlyZSgnanNvbndlYnRva2VuJyk7XHJcbmNvbnN0IE1lc3NhZ2UgPSByZXF1aXJlKCcuLi9tb2RlbHMvTWVzc2FnZScpO1xyXG5jb25zdCBVc2VyID0gcmVxdWlyZSgnLi4vbW9kZWxzL1VzZXInKTtcclxuXHJcbmZ1bmN0aW9uIGdldFRva2VuRnJvbUhhbmRzaGFrZShoYW5kc2hha2UpIHtcclxuICBjb25zdCB0ID0gaGFuZHNoYWtlPy5hdXRoPy50b2tlbiB8fCBoYW5kc2hha2U/LnF1ZXJ5Py50b2tlbjtcclxuICBpZiAodCkgcmV0dXJuIHQ7XHJcbiAgY29uc3QgaGVhZGVyID0gaGFuZHNoYWtlPy5oZWFkZXJzPy5hdXRob3JpemF0aW9uIHx8ICcnO1xyXG4gIGNvbnN0IFtzY2hlbWUsIHRva2VuXSA9IGhlYWRlci5zcGxpdCgnICcpO1xyXG4gIGlmIChzY2hlbWUgPT09ICdCZWFyZXInICYmIHRva2VuKSByZXR1cm4gdG9rZW47XHJcbiAgcmV0dXJuIG51bGw7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGdldENvbnRhY3RzKHVzZXJJZCkge1xyXG4gIC8vIFJlbnZvaWUgbGEgbGlzdGUgZGVzIHVzZXJJZHMgYXlhbnQgZMOpasOgIHVuZSBjb252ZXJzYXRpb24gMS10by0xIGF2ZWMgdXNlcklkXHJcbiAgY29uc3QgbWUgPSB1c2VySWQ7XHJcbiAgY29uc3Qgb3V0ID0gYXdhaXQgTWVzc2FnZS5hZ2dyZWdhdGUoW1xyXG4gICAge1xyXG4gICAgICAkbWF0Y2g6IHtcclxuICAgICAgICBkZWxldGVkOiBmYWxzZSxcclxuICAgICAgICAkb3I6IFt7IHNlbmRlcjogbWUgfSwgeyByZWNpcGllbnQ6IG1lIH1dLFxyXG4gICAgICB9LFxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgJHByb2plY3Q6IHtcclxuICAgICAgICBvdGhlcjogeyAkY29uZDogW3sgJGVxOiBbJyRzZW5kZXInLCBtZV0gfSwgJyRyZWNpcGllbnQnLCAnJHNlbmRlciddIH0sXHJcbiAgICAgIH0sXHJcbiAgICB9LFxyXG4gICAgeyAkZ3JvdXA6IHsgX2lkOiAnJG90aGVyJyB9IH0sXHJcbiAgXSk7XHJcbiAgcmV0dXJuIG91dC5tYXAoKGQpID0+IFN0cmluZyhkLl9pZCkpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBpbml0U29ja2V0KGlvKSB7XHJcbiAgY29uc3Qgc29ja2V0c0J5VXNlciA9IG5ldyBNYXAoKTsgLy8gdXNlcklkIC0+IFNldChzb2NrZXRJZHMpXHJcblxyXG4gIGlvLnVzZShhc3luYyAoc29ja2V0LCBuZXh0KSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB0b2tlbiA9IGdldFRva2VuRnJvbUhhbmRzaGFrZShzb2NrZXQuaGFuZHNoYWtlKTtcclxuICAgICAgaWYgKCF0b2tlbikgcmV0dXJuIG5leHQobmV3IEVycm9yKCdhdXRoX3JlcXVpcmVkJykpO1xyXG4gICAgICBjb25zdCBwYXlsb2FkID0gand0LnZlcmlmeSh0b2tlbiwgcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCk7XHJcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKHBheWxvYWQuc3ViIHx8IHBheWxvYWQuaWQpO1xyXG4gICAgICBpZiAoIXVzZXIpIHJldHVybiBuZXh0KG5ldyBFcnJvcignYXV0aF9pbnZhbGlkJykpO1xyXG4gICAgICBzb2NrZXQudXNlciA9IHVzZXI7IC8vIGF0dGFjaGUgbOKAmXV0aWxpc2F0ZXVyXHJcbiAgICAgIHJldHVybiBuZXh0KCk7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIHJldHVybiBuZXh0KG5ldyBFcnJvcignYXV0aF9pbnZhbGlkJykpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICBpby5vbignY29ubmVjdGlvbicsIGFzeW5jIChzb2NrZXQpID0+IHtcclxuICAgIGNvbnN0IHVzZXIgPSBzb2NrZXQudXNlcjtcclxuICAgIC8vIE1hcCB1c2VyIC0+IHNvY2tldFxyXG4gICAgaWYgKCFzb2NrZXRzQnlVc2VyLmhhcyhTdHJpbmcodXNlci5faWQpKSkgc29ja2V0c0J5VXNlci5zZXQoU3RyaW5nKHVzZXIuX2lkKSwgbmV3IFNldCgpKTtcclxuICAgIHNvY2tldHNCeVVzZXIuZ2V0KFN0cmluZyh1c2VyLl9pZCkpLmFkZChzb2NrZXQuaWQpO1xyXG5cclxuICAgIC8vIFN0YXR1cyBvbmxpbmUgKyBub3RpZmllciB1bmlxdWVtZW50IGxlcyBjb250YWN0c1xyXG4gICAgdHJ5IHtcclxuICAgICAgdXNlci5zdGF0dXMgPSAnb25saW5lJztcclxuICAgICAgYXdhaXQgdXNlci5zYXZlKCk7XHJcbiAgICB9IGNhdGNoIChfKSB7fVxyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGNvbnRhY3RzID0gYXdhaXQgZ2V0Q29udGFjdHModXNlci5faWQpO1xyXG4gICAgICBmb3IgKGNvbnN0IGNpZCBvZiBjb250YWN0cykge1xyXG4gICAgICAgIGNvbnN0IHJlY1NvY2tldHMgPSBzb2NrZXRzQnlVc2VyLmdldChTdHJpbmcoY2lkKSk7XHJcbiAgICAgICAgaWYgKHJlY1NvY2tldHMpIHtcclxuICAgICAgICAgIGZvciAoY29uc3Qgc2lkIG9mIHJlY1NvY2tldHMpIHtcclxuICAgICAgICAgICAgaW8uc29ja2V0cy5zb2NrZXRzLmdldChzaWQpPy5lbWl0KCd1c2VyLW9ubGluZScsIHsgdXNlcklkOiBTdHJpbmcodXNlci5faWQpIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoXykge31cclxuXHJcbiAgICBzb2NrZXQub24oJ3NlbmQtbWVzc2FnZScsIGFzeW5jIChwYXlsb2FkLCBhY2spID0+IHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB7IHRvLCBjb250ZW50IH0gPSBwYXlsb2FkIHx8IHt9O1xyXG4gICAgICAgIGlmICghdG8gfHwgdHlwZW9mIGNvbnRlbnQgIT09ICdzdHJpbmcnIHx8IGNvbnRlbnQudHJpbSgpLmxlbmd0aCA9PT0gMCB8fCBjb250ZW50Lmxlbmd0aCA+IDUwMDApIHtcclxuICAgICAgICAgIHJldHVybiBhY2sgJiYgYWNrKHsgb2s6IGZhbHNlLCBjb2RlOiAnSU5WQUxJRF9QQVlMT0FEJywgbWVzc2FnZTogJ0Rlc3RpbmF0YWlyZSBldCBjb250ZW51IHJlcXVpcyAoPD01MDAwKScgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHJlY2lwaWVudCA9IGF3YWl0IFVzZXIuZmluZEJ5SWQodG8pLnNlbGVjdCgnX2lkJyk7XHJcbiAgICAgICAgaWYgKCFyZWNpcGllbnQpIHJldHVybiBhY2sgJiYgYWNrKHsgb2s6IGZhbHNlLCBjb2RlOiAnUkVDSVBJRU5UX05PVF9GT1VORCcsIG1lc3NhZ2U6ICdEZXN0aW5hdGFpcmUgaW50cm91dmFibGUnIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBtc2cgPSBhd2FpdCBNZXNzYWdlLmNyZWF0ZSh7IHNlbmRlcjogdXNlci5faWQsIHJlY2lwaWVudDogcmVjaXBpZW50Ll9pZCwgY29udGVudDogY29udGVudC50cmltKCkgfSk7XHJcblxyXG4gICAgICAgIC8vIMOpbWV0dHJlIGF1IGRlc3RpbmF0YWlyZVxyXG4gICAgICAgIGNvbnN0IHJlY1NvY2tldHMgPSBzb2NrZXRzQnlVc2VyLmdldChTdHJpbmcocmVjaXBpZW50Ll9pZCkpO1xyXG4gICAgICAgIGlmIChyZWNTb2NrZXRzKSB7XHJcbiAgICAgICAgICBmb3IgKGNvbnN0IHNpZCBvZiByZWNTb2NrZXRzKSB7XHJcbiAgICAgICAgICAgIGlvLnNvY2tldHMuc29ja2V0cy5nZXQoc2lkKT8uZW1pdCgnbWVzc2FnZScsIHtcclxuICAgICAgICAgICAgICBfaWQ6IFN0cmluZyhtc2cuX2lkKSxcclxuICAgICAgICAgICAgICBzZW5kZXI6IFN0cmluZyhtc2cuc2VuZGVyKSxcclxuICAgICAgICAgICAgICByZWNpcGllbnQ6IFN0cmluZyhtc2cucmVjaXBpZW50KSxcclxuICAgICAgICAgICAgICBjb250ZW50OiBtc2cuY29udGVudCxcclxuICAgICAgICAgICAgICBzdGF0dXM6IG1zZy5zdGF0dXMsXHJcbiAgICAgICAgICAgICAgY3JlYXRlZEF0OiBtc2cuY3JlYXRlZEF0LFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGFjayAmJiBhY2soeyBvazogdHJ1ZSwgaWQ6IFN0cmluZyhtc2cuX2lkKSB9KTtcclxuICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIGFjayAmJiBhY2soeyBvazogZmFsc2UsIGNvZGU6ICdTRVJWRVJfRVJST1InLCBtZXNzYWdlOiAnRXJyZXVyIHNlcnZldXInIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBzb2NrZXQub24oJ21lc3NhZ2UtcmVhZCcsIGFzeW5jIChwYXlsb2FkKSA9PiB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgeyBtZXNzYWdlSWQgfSA9IHBheWxvYWQgfHwge307XHJcbiAgICAgICAgY29uc3QgbXNnID0gYXdhaXQgTWVzc2FnZS5maW5kQnlJZChtZXNzYWdlSWQpO1xyXG4gICAgICAgIGlmICghbXNnKSByZXR1cm47XHJcbiAgICAgICAgaWYgKFN0cmluZyhtc2cucmVjaXBpZW50KSAhPT0gU3RyaW5nKHVzZXIuX2lkKSkgcmV0dXJuOyAvLyBzZXVsIGxlIGRlc3RpbmF0YWlyZVxyXG4gICAgICAgIGlmIChtc2cuc3RhdHVzICE9PSAncmVhZCcpIHtcclxuICAgICAgICAgIG1zZy5zdGF0dXMgPSAncmVhZCc7XHJcbiAgICAgICAgICBhd2FpdCBtc2cuc2F2ZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBub3RpZmllciBs4oCZZXhww6lkaXRldXJcclxuICAgICAgICBjb25zdCBleHBTb2NrZXRzID0gc29ja2V0c0J5VXNlci5nZXQoU3RyaW5nKG1zZy5zZW5kZXIpKTtcclxuICAgICAgICBpZiAoZXhwU29ja2V0cykge1xyXG4gICAgICAgICAgZm9yIChjb25zdCBzaWQgb2YgZXhwU29ja2V0cykge1xyXG4gICAgICAgICAgICBpby5zb2NrZXRzLnNvY2tldHMuZ2V0KHNpZCk/LmVtaXQoJ21lc3NhZ2UtcmVhZCcsIHsgbWVzc2FnZUlkOiBTdHJpbmcobXNnLl9pZCkgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGNhdGNoIChfKSB7fVxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gdHlwaW5nOiB7IHRvLCB0eXBpbmc6IGJvb2xlYW4gfVxyXG4gICAgc29ja2V0Lm9uKCd0eXBpbmcnLCBhc3luYyAocGF5bG9hZCkgPT4ge1xyXG4gICAgICBjb25zdCB7IHRvLCB0eXBpbmcgfSA9IHBheWxvYWQgfHwge307XHJcbiAgICAgIGlmICghdG8pIHJldHVybjtcclxuICAgICAgY29uc3QgcmVjU29ja2V0cyA9IHNvY2tldHNCeVVzZXIuZ2V0KFN0cmluZyh0bykpO1xyXG4gICAgICBpZiAocmVjU29ja2V0cykge1xyXG4gICAgICAgIGZvciAoY29uc3Qgc2lkIG9mIHJlY1NvY2tldHMpIHtcclxuICAgICAgICAgIGlvLnNvY2tldHMuc29ja2V0cy5nZXQoc2lkKT8uZW1pdCgndHlwaW5nJywgeyBmcm9tOiBTdHJpbmcodXNlci5faWQpLCB0eXBpbmc6ICEhdHlwaW5nIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBpZiAodHlwaW5nKSB7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICBjb25zdCByZWNTb2NrZXRzMiA9IHNvY2tldHNCeVVzZXIuZ2V0KFN0cmluZyh0bykpO1xyXG4gICAgICAgICAgaWYgKHJlY1NvY2tldHMyKSB7XHJcbiAgICAgICAgICAgIGZvciAoY29uc3Qgc2lkIG9mIHJlY1NvY2tldHMyKSBpby5zb2NrZXRzLnNvY2tldHMuZ2V0KHNpZCk/LmVtaXQoJ3R5cGluZycsIHsgZnJvbTogU3RyaW5nKHVzZXIuX2lkKSwgdHlwaW5nOiBmYWxzZSB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LCAzMDAwKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gdXNlci1zdGF0dXM6IHJlbnZvaWUgbGUgc3RhdHV0IGNvdXJhbnQgZGUgYmFzZVxyXG4gICAgc29ja2V0Lm9uKCd1c2VyLXN0YXR1cycsIGFzeW5jIChjYikgPT4ge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHVzZXJzID0gYXdhaXQgVXNlci5maW5kKHt9KS5zZWxlY3QoJ3VzZXJuYW1lIHN0YXR1cyBsYXN0TG9naW4nKTtcclxuICAgICAgICBjYiAmJiBjYih7IG9rOiB0cnVlLCB1c2VyczogdXNlcnMubWFwKCh1KSA9PiAoeyBpZDogU3RyaW5nKHUuX2lkKSwgdXNlcm5hbWU6IHUudXNlcm5hbWUsIHN0YXR1czogdS5zdGF0dXMsIGxhc3RMb2dpbjogdS5sYXN0TG9naW4gfSkpIH0pO1xyXG4gICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgY2IgJiYgY2IoeyBvazogZmFsc2UgfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHNvY2tldC5vbignZGlzY29ubmVjdCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3Qgc2V0U29ja2V0cyA9IHNvY2tldHNCeVVzZXIuZ2V0KFN0cmluZyh1c2VyLl9pZCkpO1xyXG4gICAgICBpZiAoc2V0U29ja2V0cykge1xyXG4gICAgICAgIHNldFNvY2tldHMuZGVsZXRlKHNvY2tldC5pZCk7XHJcbiAgICAgICAgaWYgKHNldFNvY2tldHMuc2l6ZSA9PT0gMCkgc29ja2V0c0J5VXNlci5kZWxldGUoU3RyaW5nKHVzZXIuX2lkKSk7XHJcbiAgICAgIH1cclxuICAgICAgdHJ5IHtcclxuICAgICAgICB1c2VyLnN0YXR1cyA9ICdvZmZsaW5lJztcclxuICAgICAgICB1c2VyLmxhc3RMb2dpbiA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgYXdhaXQgdXNlci5zYXZlKCk7XHJcbiAgICAgIH0gY2F0Y2ggKF8pIHt9XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgY29udGFjdHMgPSBhd2FpdCBnZXRDb250YWN0cyh1c2VyLl9pZCk7XHJcbiAgICAgICAgZm9yIChjb25zdCBjaWQgb2YgY29udGFjdHMpIHtcclxuICAgICAgICAgIGNvbnN0IHJlY1NvY2tldHMgPSBzb2NrZXRzQnlVc2VyLmdldChTdHJpbmcoY2lkKSk7XHJcbiAgICAgICAgICBpZiAocmVjU29ja2V0cykge1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHNpZCBvZiByZWNTb2NrZXRzKSB7XHJcbiAgICAgICAgICAgICAgaW8uc29ja2V0cy5zb2NrZXRzLmdldChzaWQpPy5lbWl0KCd1c2VyLW9mZmxpbmUnLCB7IHVzZXJJZDogU3RyaW5nKHVzZXIuX2lkKSwgbGFzdExvZ2luOiB1c2VyLmxhc3RMb2dpbiB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSBjYXRjaCAoXykge31cclxuICAgIH0pO1xyXG4gIH0pO1xyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHsgaW5pdFNvY2tldCB9O1xyXG4iXSwibWFwcGluZ3MiOiIrc2hCQWVZO0FBQUFBLGNBQUEsU0FBQUEsQ0FBQSxTQUFBQyxjQUFBLFdBQUFBLGNBQUEsRUFBQUQsY0FBQSxHQWZaLEtBQU0sQ0FBQUUsR0FBRyxFQUFBRixjQUFBLEdBQUFHLENBQUEsTUFBR0MsT0FBTyxDQUFDLGNBQWMsQ0FBQyxFQUNuQyxLQUFNLENBQUFDLE9BQU8sRUFBQUwsY0FBQSxHQUFBRyxDQUFBLE1BQUdDLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxFQUM1QyxLQUFNLENBQUFFLElBQUksRUFBQU4sY0FBQSxHQUFBRyxDQUFBLE1BQUdDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxFQUV0QyxRQUFTLENBQUFHLHFCQUFxQkEsQ0FBQ0MsU0FBUyxDQUFFLENBQUFSLGNB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